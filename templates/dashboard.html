{% extends 'base.html' %}
{% load static %}

{% block content %}

  <!-- FORM POPUP -->
    <div id="login-popup" class="form-popup medium mfp-hide">
        <!-- CLOSE BTN -->
        <svg class="svg-cross medium close-btn">
        <use xlink:href="#svg-cross"></use>
        </svg>
        <!-- /CLOSE BTN -->

        <!-- FORM POPUP COLUMN -->
        <div class="form-popup-column small">
        <h2 class="subsection-title medium">Register now!</h2>
        <hr class="line-separator">
        <p class="small">Lorem ipsum dolor sit amet, consectetur ipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
        <!-- FORM -->
        <form>
            <!-- FORM ROW -->
            <div class="form-row">
            <label for="email" class="rl-label">Email</label>
            <input type="text" id="email" name="email" placeholder="Enter your email...">
            </div>
            <!-- /FORM ROW -->

            <!-- FORM ROW -->
            <div class="form-row">
            <label for="password" class="rl-label">Password</label>
            <input type="password" id="password" name="password" placeholder="Enter your password...">
            </div>
            <!-- /FORM ROW -->

            <!-- FORM ROW -->
            <div class="form-row separated">
            <button class="button dark full">Register to Trickster!</button>
            </div>
            <!-- /FORM ROW -->
        </form>
        <!-- /FORM -->
        </div>
        <!-- /FORM POPUP COLUMN -->

        <!-- FORM POPUP COLUMN SEPARATOR -->
        <div class="form-popup-column-separator"></div>
        <!-- /FORM POPUP COLUMN SEPARATOR -->

        <!-- FORM POPUP COLUMN -->
        <div class="form-popup-column small">
        <h2 class="subsection-title medium">Login to Trickster</h2>
        <hr class="line-separator">
        <!-- FORM -->
        <form>
            <!-- FORM ROW -->
            <div class="form-row">
            <label for="username" class="rl-label">Username</label>
            <input type="text" id="username" name="username" placeholder="Enter your username...">
            </div>
            <!-- /FORM ROW -->

            <!-- FORM ROW -->
            <div class="form-row">
            <label for="password2" class="rl-label">Password</label>
            <input type="password" id="password2" name="password2" placeholder="Enter your password...">
            </div>
            <!-- /FORM ROW -->

            <!-- FORM ROW -->
            <div class="form-row">
            <!-- CHECKBOX -->
                        <input type="checkbox" id="keep_logged" name="keep_logged" checked>
                        <label class="checkbox" for="keep_logged">
                            <span class="box">
                <!-- SVG CHECK -->
                            <svg class="svg-check">
                                <use xlink:href="#svg-check"></use>
                            </svg>
                <!-- /SVG CHECK -->
                            </span>
                            Keep me logged in
                        </label>
                        <!-- /CHECKBOX -->

            <a href="#" class="link">Forgot password?</a>
            </div>
            <!-- /FORM ROW -->

            <!-- FORM ROW -->
            <div class="form-row short-space separated">
            <button class="button full">Login to your Account</button>
            </div>
            <!-- /FORM ROW -->

            <!-- FORM ROW -->
            <div class="form-row">
            <div class="half">
                <a href="#" class="button blue full">Facebook Login</a>
            </div>
            <div class="half">
                <a href="#" class="button lightblue full">Twitter Login</a>
            </div>
            </div>
            <!-- /FORM ROW -->
        </form>
        <!-- /FORM -->
        </div>
        <!-- /FORM POPUP COLUMN -->
    </div>
  <!-- /FORM POPUP -->

  <!-- SECTION WRAP -->
    <div class="section-wrap">
    <!-- SECTION -->
        <div class="section no-title">
        <!-- CONTENT -->
        <div class="content right">
            <!-- FILTER HEADER -->
            <div class="filter-header">
            <h6 class="title">Showing {{ showing_count }} out of {{ total_songs }} results</h6>
            <!-- VIEW SELECTORS -->
            <div class="view-selectors">
                <!-- VIEW SELECTOR -->
                <a href="shop-sidebar-grid.html" class="view-selector">
                <!-- SVG GRID -->
                <svg class="svg-grid">
                    <use xlink:href="#svg-grid"></use>
                </svg>
                <!-- /SVG GRID -->
                </a>
                <!-- /VIEW SELECTOR -->

                <!-- VIEW SELECTOR -->
                <a href="shop-sidebar-list.html" class="view-selector selected">
                <!-- SVG LIST -->
                <svg class="svg-list">
                    <use xlink:href="#svg-list"></use>
                </svg>
                <!-- /SVG LIST -->
                </a>
                <!-- /VIEW SELECTOR -->
            </div>
            <!-- /VIEW SELECTORS -->

            <!-- FILTER OPTIONS -->
            
            </div>
            <!-- /FILTER HEADER -->

            <!-- SONG LIST -->
            <div class="product-list v2" id="song-list">
            {% if songs %}
                {% for song in songs %}
                <!-- SONG LIST ITEM -->
                <div class="product-list-item">
                    <!-- SONG IMG -->
                    <a href="{% url 'song_detail' song.slug %}">
                    <figure class="product-img">
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 48px;">
                            â™«
                        </div>
                    </figure>
                    </a>
                    <!-- /SONG IMG -->

                    <!-- SONG LIST ITEM INFO -->
                    <div class="product-list-item-info">
                    <a href="{% url 'song_detail' song.slug %}"><h6 class="title medium">{{ song.title }}</h6></a>
                    <p class="product-description medium">By {{ song.composer }}</p>
                    {% if song.arranged_by %}
                    <p class="product-description small">Arranged by: {{ song.arranged_by }}</p>
                    {% endif %}
                    <p class="product-description-preview">
                        <strong>Season:</strong> {{ song.get_season_display }} | 
                        <strong>Part of Mass:</strong> {{ song.get_part_of_mass_display }}
                        {% if song.mtn %}| <strong>MTN:</strong> {{ song.mtn_number }}{% endif %}
                    </p>
                    <p class="product-description small" style="color: #718096; margin-top: 10px;">
                        Uploaded: {{ song.created_at|date:"M d, Y" }}
                    </p>
                    </div>
                    <!-- /SONG LIST ITEM INFO -->
                </div>
                <!-- /SONG LIST ITEM -->
                {% endfor %}
            {% else %}
                <div style="padding: 40px; text-align: center;">
                    <h3>No songs found</h3>
                    <p>Try adjusting your filters or search query.</p>
                </div>
            {% endif %}
            </div>
            <!-- /SONG LIST -->

            <!-- PAGER WRAP -->
            {% if songs.has_other_pages %}
            <div class="pager-wrap">
            <!-- PAGER -->
            <ul class="pager">
                <!-- PAGER ITEM -->
                {% if songs.has_previous %}
                <li class="pager-item">
                <a href="?page={{ songs.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if selected_season %}&season={{ selected_season }}{% endif %}{% if selected_composer %}&composer={{ selected_composer }}{% endif %}{% if selected_mass_part %}&part_of_mass={{ selected_mass_part }}{% endif %}">
                    <!-- SVG ARROW -->
                    <svg class="svg-arrow medium inverted">
                    <use xlink:href="#svg-arrow"></use>
                    </svg>
                    <!-- /SVG ARROW -->
                </a>
                </li>
                {% endif %}
                <!-- /PAGER ITEM -->

                {% for num in songs.paginator.page_range %}
                    {% if songs.number == num %}
                    <li class="pager-item selected"><a href="#">{{ num }}</a></li>
                    {% elif num > songs.number|add:'-3' and num < songs.number|add:'3' %}
                    <li class="pager-item">
                    <a href="?page={{ num }}{% if search_query %}&q={{ search_query }}{% endif %}{% if selected_season %}&season={{ selected_season }}{% endif %}{% if selected_composer %}&composer={{ selected_composer }}{% endif %}{% if selected_mass_part %}&part_of_mass={{ selected_mass_part }}{% endif %}">{{ num }}</a>
                    </li>
                    {% endif %}
                {% endfor %}

                <!-- PAGER ITEM -->
                {% if songs.has_next %}
                <li class="pager-item">
                <a href="?page={{ songs.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if selected_season %}&season={{ selected_season }}{% endif %}{% if selected_composer %}&composer={{ selected_composer }}{% endif %}{% if selected_mass_part %}&part_of_mass={{ selected_mass_part }}{% endif %}">
                    <!-- SVG ARROW -->
                    <svg class="svg-arrow medium">
                    <use xlink:href="#svg-arrow"></use>
                    </svg>
                    <!-- /SVG ARROW -->
                </a>
                </li>
                {% endif %}
                <!-- /PAGER ITEM -->
            </ul>
            <!-- /PAGER -->
            </div>
            {% endif %}
            <!-- /PAGER WRAP -->
        </div>
        <!-- /CONTENT -->

        <!-- SIDEBAR -->
        <div class="sidebar left">
            <!-- SIDEBAR WIDGET -->
            <div class="sidebar-widget">
            <h2 class="subsection-title">Seasons</h2>
            <hr class="line-separator">
            <!-- WIDGET DROPDOWN -->
            <ul class="widget-dropdown">
                <li class="widget-dropdown-item">
                <a href="#" class="filter-link" data-filter="season" data-value="">All Seasons</a>
                </li>
                {% for season_value, season_label in seasons %}
                <li class="widget-dropdown-item">
                <a href="#" class="filter-link {% if selected_season == season_value %}active{% endif %}" data-filter="season" data-value="{{ season_value }}">{{ season_label }}</a>
                </li>
                {% endfor %}
            </ul>
            <!-- /WIDGET DROPDOWN -->
            </div>
            <!-- /SIDEBAR WIDGET -->

            <!-- SIDEBAR WIDGET -->
            <div class="sidebar-widget">
            <h2 class="subsection-title">Composer</h2>
            <hr class="line-separator">
            <!-- WIDGET DROPDOWN -->
            <ul class="widget-dropdown">
                <li class="widget-dropdown-item">
                <a href="#" class="filter-link" data-filter="composer" data-value="">All Composers</a>
                </li>
                {% for composer in composers %}
                <li class="widget-dropdown-item">
                <a href="#" class="filter-link {% if selected_composer|lower == composer|lower %}active{% endif %}" data-filter="composer" data-value="{{ composer }}">{{ composer }}</a>
                </li>
                {% endfor %}
            </ul>
            <!-- /WIDGET DROPDOWN -->
            </div>
            <!-- /SIDEBAR WIDGET -->

            <!-- SIDEBAR WIDGET -->
            <div class="sidebar-widget">
            <h2 class="subsection-title">Part of Mass</h2>
            <hr class="line-separator">

            <!-- CHECKBOX LIST -->
            <div class="checkbox-list">
                <div style="margin-bottom: 10px;">
                <input type="radio" name="part_of_mass_filter" id="mass_all" value="" class="mass-filter-radio" {% if not selected_mass_part %}checked{% endif %}>
                <label class="checkbox" for="mass_all" style="cursor: pointer;">
                    <span class="box">
                    <!-- SVG CHECK -->
                    <svg class="svg-check">
                        <use xlink:href="#svg-check"></use>
                    </svg>
                    <!-- /SVG CHECK -->
                    </span>
                    All Parts
                </label>
                </div>
                {% for mass_value, mass_label in mass_parts %}
                <div style="margin-bottom: 8px;">
                <input type="radio" name="part_of_mass_filter" id="mass_{{ mass_value }}" value="{{ mass_value }}" class="mass-filter-radio" {% if selected_mass_part == mass_value %}checked{% endif %}>
                <label class="checkbox" for="mass_{{ mass_value }}" style="cursor: pointer;">
                    <span class="box">
                    <!-- SVG CHECK -->
                    <svg class="svg-check">
                        <use xlink:href="#svg-check"></use>
                    </svg>
                    <!-- /SVG CHECK -->
                    </span>
                    {{ mass_label }}
                </label>
                </div>
                {% endfor %}
            </div>
            <!-- /CHECKBOX LIST -->
            </div>
            <!-- /SIDEBAR WIDGET -->

        </div>
        <!-- /SIDEBAR -->
        </div>
    <!-- /SECTION -->
    </div>
  <!-- /SECTION WRAP -->

  <!-- WIDGET LINE WRAP -->
    <div class="widget-line-wrap dark widget-line-copy">
        <!-- WIDGET LINE -->
        <div class="widget-line big">
        <p class="copyright"><span class="bold">Uganda Catholic Music</span> | All Rights Reserved 2016</p>
        </div>
        <!-- WIDGET LINE -->
    </div>
  <!-- WIDGET LINE WRAP -->

{% endblock %}

{% block extra_js %}
<!-- jQuery -->
<script src="{% static 'js/vendor/jquery-3.1.0.min.js' %}"></script>
<!-- magnificPopup -->
<script src="{% static 'js/vendor/jquery.magnific-popup.min.js' %}"></script>
<!-- imgLiquid -->
<script src="{% static 'js/vendor/imgLiquid-min.js' %}"></script>
<!-- jRange -->
<script src="{% static 'js/vendor/jquery.range.min.html' %}"></script>
<!-- liquid -->
<script src="{% static 'js/liquid.js' %}"></script>
<!-- dropdowns -->
<script src="{% static 'js/dropdowns.js' %}"></script>
<!-- popups -->
<script src="{% static 'js/popups.js' %}"></script>
<!-- range -->
<script src="{% static 'js/range.html' %}"></script>

<!-- Dashboard Filtering Script -->
<script>
(function() {
    // Get current URL parameters
    function getUrlParams() {
        const params = new URLSearchParams(window.location.search);
        return {
            q: params.get('q') || '',
            season: params.get('season') || '',
            composer: params.get('composer') || '',
            part_of_mass: params.get('part_of_mass') || '',
            page: params.get('page') || '1'
        };
    }

    // Build URL with filters
    function buildFilterUrl(filters) {
        const params = new URLSearchParams();
        if (filters.q) params.set('q', filters.q);
        if (filters.season) params.set('season', filters.season);
        if (filters.composer) params.set('composer', filters.composer);
        if (filters.part_of_mass) params.set('part_of_mass', filters.part_of_mass);
        if (filters.page && filters.page !== '1') params.set('page', filters.page);
        
        const queryString = params.toString();
        return queryString ? '?' + queryString : '';
    }

    // Apply filters and reload page
    function applyFilters(newFilters) {
        const currentParams = getUrlParams();
        const filters = Object.assign({}, currentParams, newFilters);
        // Reset to page 1 when filters change (unless it's a page change)
        if (!newFilters.page) {
            filters.page = '1';
        }
        const url = buildFilterUrl(filters);
        window.location.href = window.location.pathname + url;
    }

    // Handle filter link clicks
    document.addEventListener('DOMContentLoaded', function() {
        // Season and Composer filter links
        const filterLinks = document.querySelectorAll('.filter-link');
        filterLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const filterType = this.getAttribute('data-filter');
                const filterValue = this.getAttribute('data-value');
                
                // Remove active class from siblings in the same widget
                const widget = this.closest('.sidebar-widget');
                if (widget) {
                    widget.querySelectorAll('.filter-link').forEach(sib => sib.classList.remove('active'));
                    this.classList.add('active');
                }
                
                // Apply filter
                applyFilters({ [filterType]: filterValue });
            });
        });

        // Part of Mass radio buttons
        const massRadios = document.querySelectorAll('.mass-filter-radio');
        massRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.checked) {
                    const value = this.value || '';
                    applyFilters({ part_of_mass: value });
                }
            });
        });

        // Search input in navbar (already handled by form submission, but we can add debounce for real-time)
        const searchInput = document.querySelector('.navbar-search input[name="q"]');
        if (searchInput) {
            let searchTimeout;
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                // Optionally add real-time search with debounce
                // For now, we'll keep form submission behavior
            });
        }
    });
})();
</script>
{% endblock %}
